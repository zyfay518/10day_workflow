# å‰åç«¯æ¥å£è®¾è®¡æ–‡æ¡£ - 10æ—¥å·¥ä½œæµç®¡ç†ç³»ç»Ÿ

> **é¡¹ç›®åç§°**: 10-Day Flow (10æ—¥å·¥ä½œæµç®¡ç†)
> **æ–‡æ¡£ç‰ˆæœ¬**: v1.0
> **æ›´æ–°æ—¥æœŸ**: 2026-02-25
> **åŸºç¡€æ¶æ„**: React + TypeScript + localStorage (æœ¬åœ°æµ‹è¯•) â†’ Supabase (äº‘ç«¯éƒ¨ç½²)

---

## ğŸ“‹ ç›®å½•

1. [æ€»ä½“æ¶æ„](#ä¸€æ€»ä½“æ¶æ„)
2. [é¡µé¢äº¤äº’åˆ†æ](#äºŒé¡µé¢äº¤äº’åˆ†æ)
3. [æ•°æ®æ¥å£è®¾è®¡](#ä¸‰æ•°æ®æ¥å£è®¾è®¡)
4. [Hookè®¾è®¡](#å››hookè®¾è®¡)
5. [å®æ—¶æ•°æ®åŒæ­¥](#äº”å®æ—¶æ•°æ®åŒæ­¥)
6. [APIè°ƒç”¨æµç¨‹](#å…­apiè°ƒç”¨æµç¨‹)
7. [é”™è¯¯å¤„ç†ä¸éªŒè¯](#ä¸ƒé”™è¯¯å¤„ç†ä¸éªŒè¯)
8. [æ€§èƒ½ä¼˜åŒ–å»ºè®®](#å…«æ€§èƒ½ä¼˜åŒ–å»ºè®®)
9. [è¿ç§»è®¡åˆ’](#ä¹è¿ç§»è®¡åˆ’-localstorage--supabase)
10. [æµ‹è¯•æ¸…å•](#åæµ‹è¯•æ¸…å•)

---

## ä¸€ã€æ€»ä½“æ¶æ„

### 1.1 ç³»ç»Ÿåˆ†å±‚

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           User Interface Layer           â”‚
â”‚  Home / Record / History / Report / ...  â”‚
â”‚  (React Components + Tailwind CSS)       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚ Hooks + Context
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚        Data Access Layer (Hooks)         â”‚
â”‚ useAuth / useCycles / useRecords / ...   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚ localStorage / Supabase
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚      Backend Storage (å¯åˆ‡æ¢)            â”‚
â”‚   localStorage (å¼€å‘) / Supabase (ç”Ÿäº§)   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 1.2 æŠ€æœ¯æ ˆ

| å±‚çº§ | æŠ€æœ¯ | è¯´æ˜ |
|------|------|------|
| **å‰ç«¯æ¡†æ¶** | React 19 + TypeScript | ç»„ä»¶å¼€å‘å’Œç±»å‹å®‰å…¨ |
| **çŠ¶æ€ç®¡ç†** | React Hooks | è½»é‡çº§çŠ¶æ€ç®¡ç† |
| **è·¯ç”±** | React Router v7 | é¡µé¢è·¯ç”±å’Œå¯¼èˆª |
| **æ ·å¼** | Tailwind CSS v4 | åŸå­åŒ–CSSæ¡†æ¶ |
| **å›¾è¡¨åº“** | Recharts | æ•°æ®å¯è§†åŒ– |
| **å›¾æ ‡** | Material Symbols | å›¾æ ‡åº“ |
| **å­˜å‚¨** | localStorage (å¼€å‘) / Supabase Storage (ç”Ÿäº§) | æ–‡ä»¶å’Œå›¾ç‰‡å­˜å‚¨ |
| **æ•°æ®åº“** | Supabase (PostgreSQL) | åç«¯æ•°æ®åº“ (æœªæ¥) |
| **è®¤è¯** | Supabase Auth | ç”¨æˆ·è®¤è¯ç®¡ç† (æœªæ¥) |
| **AIæœåŠ¡** | Google Gemini API | AIæ–‡å­—è¯†åˆ«å’Œè§£æ (æœªæ¥) |

### 1.3 æ•°æ®æµå‘å›¾

```
ç”¨æˆ·æ“ä½œ (UI Event)
    â†“
React Event Handler
    â†“
Custom Hook (useRecords/useCycles/...)
    â†“
localStorage.ts (æœ¬åœ°å­˜å‚¨å±‚)
    â†“
æµè§ˆå™¨ localStorage
    â†“
æ•°æ®å˜æ›´é€šçŸ¥
    â†“
Hook State æ›´æ–°
    â†“
React Re-render
    â†“
UI æ›´æ–°æ˜¾ç¤º
```

---

## äºŒã€é¡µé¢äº¤äº’åˆ†æ

### 2.1 é¦–é¡µ (Home.tsx) âœ… å·²è¿æ¥åç«¯

#### é¡µé¢åŠŸèƒ½æ¦‚è¿°

é¦–é¡µæ˜¯åº”ç”¨çš„æ ¸å¿ƒå…¥å£ï¼Œå±•ç¤ºç”¨æˆ·çš„37ä¸ªå‘¨æœŸå®Œæˆæƒ…å†µçŸ©é˜µï¼Œå½“å‰å‘¨æœŸè¿›åº¦ï¼Œä»¥åŠä»Šæ—¥è®°å½•çŠ¶æ€ã€‚

#### é¡µé¢å…ƒç´ ä¸äº¤äº’

| å…ƒç´  | ç±»å‹ | åŠŸèƒ½è¯´æ˜ | æ•°æ®æº | æ“ä½œå | çŠ¶æ€ |
|------|------|--------|--------|--------|------|
| **ç”¨æˆ·å¤´åƒ** | åœ†å½¢å¤´åƒ | æ˜¾ç¤ºç”¨æˆ·åŸºæœ¬ä¿¡æ¯ | user_profiles.nickname | ç‚¹å‡»è·³è½¬åˆ°Profileé¡µ | âœ… |
| **è®¾ç½®æŒ‰é’®** | Icon Button | æ‰“å¼€è®¾ç½®é¡µé¢ | - | è·³è½¬ /profile | âœ… |
| **37å‘¨æœŸçŸ©é˜µ** | Grid Layout (6Ã—6+1) | å±•ç¤ºæ‰€æœ‰å‘¨æœŸå®Œæˆåº¦ | cycles.completion_rate | ç‚¹å‡»æŸ¥çœ‹è¯¦æƒ… | ğŸŸ¡ é™æ€ |
| **å½“å‰å‘¨æœŸå¡ç‰‡** | Card | æ˜¾ç¤ºè¿›åº¦æ¡å’Œç™¾åˆ†æ¯” | cycles è¡¨å½“å‰å‘¨æœŸæ•°æ® | åˆ·æ–°æ•°æ® | âœ… |
| **ä»Šæ—¥è®°å½•çŠ¶æ€** | Tag åˆ—è¡¨ | æ˜¾ç¤ºå„ç»´åº¦è®°å½•çŠ¶æ€ | records è¡¨ä»Šæ—¥æ•°æ® | å®æ—¶æ›´æ–° | âœ… |
| **å¼€å§‹è®°å½•æŒ‰é’®** | Primary Button | è·³è½¬åˆ°è®°å½•é¡µ | - | å¯¼èˆªåˆ° /record | âœ… |
| **æŸ¥çœ‹æŠ¥å‘ŠæŒ‰é’®** | Secondary Button | è·³è½¬åˆ°æŠ¥å‘Šé¡µ | - | å¯¼èˆªåˆ° /report | âœ… |

#### æ¶‰åŠçš„æ•°æ®è¡¨

- `user_profiles` - ç”¨æˆ·åŸºæœ¬ä¿¡æ¯ âœ…
- `cycles` - å‘¨æœŸæ•°æ® âœ…
- `dimensions` - ç»´åº¦é…ç½® âœ…
- `records` - è®°å½•æ•°æ®ï¼ˆç”¨äºè®¡ç®—ä»Šæ—¥çŠ¶æ€ï¼‰âœ…

---

### 2.2 è®°å½•é¡µ (Record.tsx) âœ… å·²è¿æ¥åç«¯ â­ æ ¸å¿ƒé¡µé¢

#### é¡µé¢åŠŸèƒ½æ¦‚è¿°

è®°å½•é¡µæ˜¯åº”ç”¨çš„æ ¸å¿ƒåŠŸï¿½ï¿½ï¿½é¡µé¢ï¼Œç”¨æˆ·åœ¨æ­¤è¾“å…¥å„ç»´åº¦çš„æ—¥è®°å†…å®¹ã€‚æ”¯æŒç»´åº¦åˆ‡æ¢ã€æ—¥æœŸé€‰æ‹©ã€‚

#### é¡µé¢å…ƒç´ ä¸äº¤äº’

| å…ƒç´  | ç±»å‹ | åŠŸèƒ½è¯´æ˜ | æ•°æ®æº | æ“ä½œå | çŠ¶æ€ |
|------|------|--------|--------|--------|------|
| **è¿”å›æŒ‰é’®** | Icon Button | è¿”å›é¦–é¡µ | - | å¯¼èˆªåˆ° / | âœ… |
| **æ—¥å†æŒ‰é’®** | Icon Button | æ‰“å¼€æ—¥æœŸé€‰æ‹©å™¨ | cycles çš„æ—¥æœŸèŒƒå›´ | å¼¹å‡ºæ—¥æœŸé€‰æ‹© | âœ… |
| **é€‰ä¸­æ—¥æœŸæ˜¾ç¤º** | Text | æ˜¾ç¤ºå½“å‰é€‰ä¸­æ—¥æœŸ | state: selectedDate | æ›´æ–°ä¸ºæ–°é€‰ä¸­æ—¥æœŸ | âœ… |
| **ç»´åº¦ Tabæ ** | Tab Group | åˆ‡æ¢äº”ä¸ªç»´åº¦ | dimensions è¡¨ | åŠ è½½å¯¹åº”ç»´åº¦çš„è®°å½• | âœ… |
| **æ–‡æœ¬è¾“å…¥æ¡†** | Textarea | è¾“å…¥ç»´åº¦å†…å®¹ | record.content | ä¿å­˜è®°å½• | âœ… |
| **æ‹ç…§æŒ‰é’®** | Icon Button | è°ƒç”¨è®¾å¤‡æ‘„åƒå¤´ | - | ğŸ”µ TODO | âŒ |
| **è¯­éŸ³æŒ‰é’®** | Icon Button | å½•åˆ¶è¯­éŸ³ | - | ğŸ”µ TODO | âŒ |
| **å›¾ç‰‡æŒ‰é’®** | Icon Button | é€‰æ‹©æœ¬åœ°å›¾ç‰‡ | - | ğŸ”µ TODO | âŒ |
| **AIè§£ææŒ‰é’®** | Primary Button | è´¹ç”¨ç»´åº¦æ˜¾ç¤º | - | å¯¼èˆªåˆ° /expense | âœ… |
| **ä»Šæ—¥è®°å½•æ¦‚è§ˆ** | Tag åˆ—è¡¨ | æ˜¾ç¤º5ä¸ªç»´åº¦çš„å®ŒæˆçŠ¶æ€ | records è¡¨ | å®æ—¶æ›´æ–° | âœ… |
| **ä¿å­˜è®°å½•æŒ‰é’®** | Gradient Button | ä¿å­˜å½“å‰ç»´åº¦è®°å½• | record.content | è°ƒç”¨ saveRecord() | âœ… |
| **ä»Šæ—¥å®ŒæˆæŒ‰é’®** | Primary Button | æ ‡è®°ä»Šæ—¥å…¨éƒ¨å®Œæˆ | - | éªŒè¯æ‰€æœ‰ç»´åº¦åå¯¼èˆª | âœ… |

#### æ¶‰åŠçš„æ•°æ®è¡¨

- `user_profiles` - ç”¨æˆ·ä¿¡æ¯ âœ…
- `cycles` - å‘¨æœŸæ•°æ® âœ…
- `dimensions` - ç»´åº¦é…ç½® âœ…
- `records` - æ ¸å¿ƒè®°å½•è¡¨ âœ…
- `record_attachments` - é™„ä»¶è¡¨ âŒ TODO

---

### 2.3 è´¹ç”¨è®°å½•ç‰¹æ®Šé¡µ (Expense.tsx) âŒ æœªè¿æ¥åç«¯

#### é¡µé¢åŠŸèƒ½æ¦‚è¿°

è´¹ç”¨è®°å½•é¡µé¢æä¾›AIæ™ºèƒ½è§£æè´¦å•åŠŸèƒ½ï¼Œè‡ªåŠ¨è¯†åˆ«å¼€é”€ä¿¡æ¯å¹¶åˆ†ç±»ã€‚

#### é¡µé¢å…ƒç´ ä¸äº¤äº’

| å…ƒç´  | ç±»å‹ | åŠŸèƒ½è¯´æ˜ | æ•°æ®æº | çŠ¶æ€ |
|------|------|--------|--------|------|
| **è¿”å›æŒ‰é’®** | Icon Button | è¿”å›è®°å½•é¡µ | - | âœ… |
| **è¾“å…¥æ¡†** | Textarea | è¾“å…¥å¼€é”€ä¿¡æ¯ | state: text | ğŸŸ¡ é™æ€ |
| **AIè§£ææŒ‰é’®** | Primary Button | è°ƒç”¨Gemini APIè§£æ | Gemini API | âŒ TODO |
| **è§£æç»“æœå¡ç‰‡** | Card List | æ˜¾ç¤ºAIè¯†åˆ«çš„å¼€é”€é¡¹ | - | âŒ TODO |
| **ç¡®è®¤è®°å½•æŒ‰é’®** | Primary Button | ä¿å­˜æ‰€æœ‰å¼€é”€ | expenses è¡¨ | âŒ TODO |

#### éœ€è¦å¼€å‘çš„åŠŸèƒ½

- [ ] åˆ›å»º `useExpenses` Hook
- [ ] å®ç° AI è§£ææ¥å£ï¼ˆæœªæ¥ï¼‰
- [ ] æ‰¹é‡ä¿å­˜å¼€é”€åˆ° expenses è¡¨

---

### 2.4 å†å²è®°å½•é¡µ (History.tsx) âŒ æœªè¿æ¥åç«¯

#### é¡µé¢åŠŸèƒ½æ¦‚è¿°

å±•ç¤ºå½“å‰å‘¨æœŸå†…çš„æ‰€æœ‰è®°å½•ï¼Œæ”¯æŒæ—¥æœŸèŒƒå›´ç­›é€‰ã€ç»´åº¦ç­›é€‰ã€å…¨æ–‡æœç´¢ã€‚

#### é¡µé¢å…ƒç´ ä¸äº¤äº’

| å…ƒç´  | ç±»å‹ | åŠŸèƒ½è¯´æ˜ | æ•°æ®æº | çŠ¶æ€ |
|------|------|--------|--------|------|
| **æœç´¢æŒ‰é’®** | Icon Button | æ‰“å¼€æœç´¢æ¡† | - | ğŸŸ¡ é™æ€ |
| **æœç´¢è¾“å…¥æ¡†** | Input | è¾“å…¥å…³é”®è¯æœç´¢ | state | ğŸŸ¡ é™æ€ |
| **æ—¥æœŸç­›é€‰** | Dropdown Button | é€‰æ‹©æ—¥æœŸèŒƒå›´ | cycles | âŒ TODO |
| **ç»´åº¦ç­›é€‰** | Dropdown Button | é€‰æ‹©ç‰¹å®šç»´åº¦ | dimensions | âŒ TODO |
| **è®°å½•å¡ç‰‡** | Card List | æ˜¾ç¤ºè®°å½•å†…å®¹ | records | âŒ TODO |
| **é™„ä»¶ç¼©ç•¥å›¾** | Image Grid | æ˜¾ç¤ºä¸Šä¼ çš„å›¾ç‰‡ | record_attachments | âŒ TODO |
| **å¼€é”€æ˜ç»†** | Expense List | æ˜¾ç¤ºè¯¥è®°å½•çš„å¼€é”€ | expenses | âŒ TODO |

#### éœ€è¦å¼€å‘çš„åŠŸèƒ½

- [ ] åˆ›å»º `useHistory` Hook æˆ–æ‰©å±• `useRecords`
- [ ] å®ç°æ—¥æœŸèŒƒå›´æŸ¥è¯¢
- [ ] å®ç°ç»´åº¦è¿‡æ»¤
- [ ] å®ç°å…¨æ–‡æœç´¢

---

### 2.5 æŠ¥å‘Šé¡µ (Report.tsx) âŒ æœªè¿æ¥åç«¯

#### é¡µé¢åŠŸèƒ½æ¦‚è¿°

å±•ç¤ºå‘¨æœŸæŠ¥å‘Šã€æ—¶é—´è½´å’Œæ•°æ®æ´å¯Ÿã€‚éœ€è¦AIèšåˆåˆ†æåŠŸèƒ½ã€‚

#### Tab 1: å‘¨æœŸæŠ¥å‘Š âŒ TODO

| å…ƒç´  | åŠŸèƒ½è¯´æ˜ | çŠ¶æ€ |
|------|--------|------|
| **å‘¨æœŸé€‰æ‹©å™¨** | é€‰æ‹©æŸ¥çœ‹å“ªä¸ªå‘¨æœŸ | âŒ |
| **AIè¯„ä»·å¡ç‰‡** | æ˜¾ç¤ºå®Œæˆåº¦å’Œå»ºè®® | âŒ |
| **å„ç»´åº¦å¡ç‰‡** | æ˜¾ç¤ºå„ç»´åº¦æ€»ç»“ | âŒ |
| **å¯¼å‡ºæŒ‰é’®** | å¯¼å‡ºPDF/Markdown | âŒ |

#### Tab 2: æ—¶é—´è½´ âŒ TODO

| å…ƒç´  | åŠŸèƒ½è¯´æ˜ | çŠ¶æ€ |
|------|--------|------|
| **å®Œæˆåº¦è¶‹åŠ¿å›¾** | æ˜¾ç¤ºå„å‘¨æœŸå®Œæˆåº¦æ›²çº¿ | âŒ |
| **é‡Œç¨‹ç¢‘æ—¶é—´è½´** | æ˜¾ç¤ºé‡è¦äº‹ä»¶ | âŒ |

#### Tab 3: æ•°æ®æ´å¯Ÿ âŒ TODO

| å…ƒç´  | åŠŸèƒ½è¯´æ˜ | çŠ¶æ€ |
|------|--------|------|
| **å…¨å±€ç»Ÿè®¡å¡ç‰‡** | æ˜¾ç¤ºç´¯ï¿½ï¿½ï¿½æ•°æ® | âŒ |
| **ç»´åº¦åˆ†å¸ƒé›·è¾¾å›¾** | å„ç»´åº¦æ´»è·ƒåº¦å¯¹æ¯” | âŒ |
| **å¼€é”€è¶‹åŠ¿å›¾** | æŒ‰å‘¨æœŸæ˜¾ç¤ºå¼€é”€ | âŒ |
| **å…³é”®è¯è¯äº‘** | æ˜¾ç¤ºæå–çš„å…³é”®è¯ | âŒ |

#### éœ€è¦å¼€å‘çš„åŠŸèƒ½

- [ ] åˆ›å»º `useReport` Hook
- [ ] åˆ›å»º `useMilestones` Hook
- [ ] å®ç°AIæŠ¥å‘Šç”Ÿæˆæ¥å£ï¼ˆæœªæ¥ï¼‰
- [ ] å®ç°å¯¼å‡ºåŠŸèƒ½

---

### 2.6 ä¸ªäººè®¾ç½®é¡µ (Profile.tsx) âŒ æœªè¿æ¥åç«¯

#### é¡µé¢åŠŸèƒ½æ¦‚è¿°

ç”¨æˆ·ä¸ªäººä¿¡æ¯ç®¡ç†å’Œåº”ç”¨è®¾ç½®ã€‚

#### é¡µé¢å…ƒç´ ä¸äº¤äº’

| å…ƒç´  | åŠŸèƒ½è¯´æ˜ | æ•°æ®æº | çŠ¶æ€ |
|------|--------|--------|------|
| **å¤´åƒä¸Šä¼ ** | ä¸Šä¼ /æ›´æ¢å¤´åƒ | user_profiles.avatar_url | âŒ TODO |
| **æ˜µç§°ç¼–è¾‘** | ä¿®æ”¹ç”¨æˆ·æ˜µç§° | user_profiles.nickname | âŒ TODO |
| **æ¨é€é€šçŸ¥å¼€å…³** | å¯ç”¨/ç¦ç”¨é€šçŸ¥ | user_profiles | âŒ TODO |
| **é€€å‡ºç™»å½•** | æ¸…é™¤ä¼šè¯ | - | âŒ TODO |

#### éœ€è¦å¼€å‘çš„åŠŸèƒ½

- [ ] æ‰©å±• `useUserProfile` Hook æ”¯æŒæ›´æ–°åŠŸèƒ½
- [ ] å®ç°å¤´åƒä¸Šä¼ åˆ° Storageï¼ˆæœªæ¥ï¼‰

---

## ä¸‰ã€æ•°æ®æ¥å£è®¾è®¡

### 3.1 ç”¨æˆ·ç›¸å…³æ¥å£

#### 3.1.1 è·å–ç”¨æˆ·ä¿¡æ¯

```typescript
// Hook: useUserProfile(userId)
const getUserProfile = (userId: string) => {
  const profiles = getFromStorage<UserProfile>('user_profiles');
  return profiles.find(p => p.user_id === userId) || null;
};

// è¿”å›æ•°æ®ç»“æ„
{
  id: number;
  user_id: string;
  nickname: string;
  avatar_url: string | null;
  created_at: string;
  updated_at: string;
}
```

#### 3.1.2 æ›´æ–°ç”¨æˆ·ä¿¡æ¯

```typescript
// Hook: updateProfile(updates)
const updateUserProfile = (userId: string, updates: Partial<UserProfile>) => {
  const profiles = getFromStorage<UserProfile>('user_profiles');
  const index = profiles.findIndex(p => p.user_id === userId);

  if (index === -1) return false;

  profiles[index] = {
    ...profiles[index],
    ...updates,
    updated_at: new Date().toISOString()
  };

  saveToStorage('user_profiles', profiles);
  return true;
};
```

---

### 3.2 å‘¨æœŸç›¸å…³æ¥å£

#### 3.2.1 è·å–æ‰€æœ‰å‘¨æœŸ

```typescript
// Hook: useCycles(userId)
const getCycles = (userId: string): Cycle[] => {
  const cycles = getFromStorage<Cycle>('cycles');
  return cycles.filter(c => c.user_id === userId)
                .sort((a, b) => a.cycle_number - b.cycle_number);
};

// è¿”å›æ•°æ®ç»“æ„ (æ•°ç»„)
[
  {
    id: number;
    user_id: string;
    cycle_number: number;        // 1-37
    start_date: string;          // YYYY-MM-DD
    end_date: string;            // YYYY-MM-DD
    total_days: number;          // 10 or 5
    completion_rate: number;     // 0-100
    status: 'pending' | 'active' | 'completed';
    created_at: string;
    updated_at: string;
  }
]
```

#### 3.2.2 è·å–å½“å‰å‘¨æœŸ

```typescript
// Hook: currentCycle from useCycles()
const getCurrentCycle = (userId: string): Cycle | null => {
  const cycles = getCycles(userId);
  return cycles.find(c => c.status === 'active') || cycles[0] || null;
};
```

---

### 3.3 è®°å½•ç›¸å…³æ¥å£

#### 3.3.1 è·å–å•æ¡è®°å½•

```typescript
// Hook: useRecords({ userId, cycleId, dimensionId, date })
const getRecord = (params: {
  userId: string;
  cycleId: number;
  dimensionId: number;
  date: string;
}): Record | null => {
  const records = getFromStorage<Record>('records');
  return records.find(r =>
    r.user_id === params.userId &&
    r.cycle_id === params.cycleId &&
    r.dimension_id === params.dimensionId &&
    r.record_date === params.date
  ) || null;
};

// è¿”å›æ•°æ®ç»“æ„
{
  id: number;
  user_id: string;
  cycle_id: number;
  dimension_id: number;
  record_date: string;         // YYYY-MM-DD
  content: string;
  word_count: number;
  status: 'draft' | 'published';
  created_at: string;
  updated_at: string;
}
```

#### 3.3.2 ä¿å­˜/æ›´æ–°è®°å½• (Upsert)

```typescript
// Hook: saveRecord(content, status)
const saveRecord = (params: {
  userId: string;
  cycleId: number;
  dimensionId: number;
  date: string;
  content: string;
  status?: 'draft' | 'published';
}): Record => {
  const records = getFromStorage<Record>('records');
  const existing = getRecord(params);

  if (existing) {
    // æ›´æ–°ç°æœ‰è®°å½•
    const index = records.findIndex(r => r.id === existing.id);
    records[index] = {
      ...records[index],
      content: params.content,
      word_count: params.content.length,
      status: params.status || 'published',
      updated_at: new Date().toISOString()
    };
    saveToStorage('records', records);

    // è§¦å‘å®Œæˆåº¦æ›´æ–°
    updateCycleCompletionRate(params.cycleId);

    return records[index];
  } else {
    // æ’å…¥æ–°è®°å½•
    const newRecord: Record = {
      id: generateId(),
      user_id: params.userId,
      cycle_id: params.cycleId,
      dimension_id: params.dimensionId,
      record_date: params.date,
      content: params.content,
      word_count: params.content.length,
      status: params.status || 'published',
      created_at: new Date().toISOString(),
      updated_at: new Date().toISOString()
    };
    records.push(newRecord);
    saveToStorage('records', records);

    // è§¦å‘å®Œæˆåº¦æ›´æ–°
    updateCycleCompletionRate(params.cycleId);

    return newRecord;
  }
};
```

#### 3.3.3 æŒ‰æ—¥æœŸèŒƒå›´è·å–è®°å½• (History é¡µéœ€è¦)

```typescript
// TODO: éœ€è¦åˆ›å»ºæ–°çš„ Hook æˆ–æ‰©å±• useRecords
const getRecordsByDateRange = (params: {
  userId: string;
  cycleId: number;
  startDate: string;
  endDate: string;
}): Record[] => {
  const records = getFromStorage<Record>('records');
  return records.filter(r =>
    r.user_id === params.userId &&
    r.cycle_id === params.cycleId &&
    r.record_date >= params.startDate &&
    r.record_date <= params.endDate
  ).sort((a, b) => b.record_date.localeCompare(a.record_date));
};
```

---

### 3.4 å¼€é”€ç›¸å…³æ¥å£ (TODO)

#### 3.4.1 ä¿å­˜å¼€é”€

```typescript
// TODO: éœ€è¦åˆ›å»º useExpenses Hook
const saveExpense = (expense: {
  userId: string;
  recordId?: number;
  expenseDate: string;
  amount: number;
  category: string;
  merchant?: string;
  notes?: string;
  aiParsed?: boolean;
}): Expense => {
  const expenses = getFromStorage<Expense>('expenses');
  const newExpense: Expense = {
    id: generateId(),
    ...expense,
    created_at: new Date().toISOString(),
    updated_at: new Date().toISOString()
  };
  expenses.push(newExpense);
  saveToStorage('expenses', expenses);
  return newExpense;
};
```

---

## å››ã€Hookè®¾è®¡

### 4.1 å·²å®ç°çš„Hooks âœ…

#### 4.1.1 useAuth.local.ts âœ…

```typescript
/**
 * ç”¨æˆ·è®¤è¯ Hook
 */
export function useAuth(): UseAuthReturn {
  user: User | null;           // å½“å‰ç”¨æˆ· { id, phone }
  loading: boolean;
  login: (phone: string) => void;
  logout: () => void;
}

// ä½¿ç”¨ç¤ºä¾‹
const { user, login, logout } = useAuth();
```

#### 4.1.2 useUserProfile.local.ts âœ…

```typescript
/**
 * ç”¨æˆ·æ¡£æ¡ˆ Hook
 */
export function useUserProfile(userId?: string) {
  profile: UserProfile | null;
  loading: boolean;
  updateProfile: (updates: Partial<UserProfile>) => boolean;
}
```

#### 4.1.3 useCycles.local.ts âœ…

```typescript
/**
 * å‘¨æœŸç®¡ç† Hook
 */
export function useCycles(userId?: string): UseCyclesReturn {
  cycles: Cycle[];
  currentCycle: Cycle | null;
  loading: boolean;
  refreshCycles: () => void;
}
```

#### 4.1.4 useRecords.local.ts âœ…

```typescript
/**
 * è®°å½•ç®¡ç† Hook
 */
export function useRecords(params: UseRecordsParams): UseRecordsReturn {
  record: Record | null;
  loading: boolean;
  saving: boolean;
  saveRecord: (content: string, status?: 'draft' | 'published') => boolean;
}
```

#### 4.1.5 useDimensions.local.ts âœ…

```typescript
/**
 * ç»´åº¦é…ç½® Hook
 */
export function useDimensions(userId?: string) {
  dimensions: Dimension[];
  loading: boolean;
  updateDimension: (dimensionId: number, updates: Partial<Dimension>) => boolean;
}
```

---

### 4.2 éœ€è¦åˆ›å»ºçš„æ–°Hooks

#### 4.2.1 useExpenses.local.ts âŒ TODO

```typescript
/**
 * å¼€é”€ç®¡ç† Hook
 * ç”¨äº Expense.tsx å’Œ History.tsx
 */
export function useExpenses(params: {
  userId?: string;
  startDate?: string;
  endDate?: string;
}) {
  // è¿”å›å€¼
  expenses: Expense[];
  loading: boolean;

  // æ–¹æ³•
  saveExpense: (expense: ExpenseInput) => Promise<Expense>;
  getExpensesByDateRange: (start: string, end: string) => Expense[];
  deleteExpense: (id: number) => boolean;
  getTotalByCategory: (category: string) => number;
  getTotalAmount: () => number;
}

// ä½¿ç”¨ç¤ºä¾‹
const { expenses, saveExpense, getTotalAmount } = useExpenses({
  userId: user.id,
  startDate: '2026-02-24',
  endDate: '2026-03-05'
});
```

#### 4.2.2 useHistory.local.ts âŒ TODO

```typescript
/**
 * å†å²è®°å½• Hook
 * ç”¨äº History.tsx
 */
export function useHistory(params: {
  userId?: string;
  cycleId?: number;
}) {
  // è¿”å›å€¼
  records: RecordWithDetails[];  // åŒ…å«ç»´åº¦ã€é™„ä»¶ã€å¼€é”€ä¿¡æ¯
  loading: boolean;

  // æ–¹æ³•
  searchRecords: (query: string) => RecordWithDetails[];
  filterByDimension: (dimensionId: number) => RecordWithDetails[];
  filterByDateRange: (start: string, end: string) => RecordWithDetails[];
}
```

#### 4.2.3 useReport.local.ts âŒ TODO

```typescript
/**
 * æŠ¥å‘Šç®¡ç† Hook
 * ç”¨äº Report.tsx
 */
export function useReport(cycleId?: number, userId?: string) {
  // è¿”å›å€¼
  report: CycleReport | null;
  loading: boolean;
  generating: boolean;

  // æ–¹æ³•
  generateReport: () => Promise<CycleReport>;  // æœªæ¥AIç”Ÿæˆ
  getStatistics: () => Statistics;
  exportMarkdown: () => string;
}
```

#### 4.2.4 useMilestones.local.ts âŒ TODO

```typescript
/**
 * é‡Œç¨‹ç¢‘äº‹ä»¶ Hook
 * ç”¨äº Report.tsx æ—¶é—´è½´åŠŸèƒ½
 */
export function useMilestones(userId?: string) {
  // è¿”å›å€¼
  milestones: Milestone[];
  loading: boolean;

  // æ–¹æ³•
  addMilestone: (milestone: MilestoneInput) => Milestone;
  updateMilestone: (id: number, updates: Partial<Milestone>) => boolean;
  deleteMilestone: (id: number) => boolean;
}
```

#### 4.2.5 useAttachments.local.ts âŒ TODO

```typescript
/**
 * é™„ä»¶ç®¡ç† Hook
 * ç”¨äº Record.tsx å’Œ History.tsx
 */
export function useAttachments(recordId?: number, userId?: string) {
  // è¿”å›å€¼
  attachments: RecordAttachment[];
  loading: boolean;
  uploading: boolean;

  // æ–¹æ³•
  uploadFile: (file: File, fileType: 'image' | 'audio') => Promise<RecordAttachment>;
  deleteAttachment: (id: number) => boolean;
  // æœªæ¥: OCRè¯†åˆ«
  getOCRText: (attachmentId: number) => Promise<string>;
}
```

---

## äº”ã€å®æ—¶æ•°æ®åŒæ­¥

### 5.1 localStorage ç‰ˆæœ¬ï¼ˆå½“å‰ï¼‰

- æ•°æ®å­˜å‚¨åœ¨æµè§ˆå™¨ localStorage
- æ— å®æ—¶åŒæ­¥åŠŸèƒ½
- åˆ·æ–°é¡µé¢æ—¶é‡æ–°åŠ è½½æ•°æ®

### 5.2 Supabase ç‰ˆæœ¬ï¼ˆæœªæ¥ï¼‰

```typescript
// ç¤ºä¾‹: Home.tsx - è®¢é˜…å‘¨æœŸå®Œæˆåº¦å˜åŒ–
useEffect(() => {
  if (!userId) return;

  const channel = supabase
    .channel(`cycles-${userId}`)
    .on('postgres_changes', {
      event: 'UPDATE',
      schema: 'public',
      table: 'cycles',
      filter: `user_id=eq.${userId}`
    }, (payload) => {
      // æ›´æ–°æœ¬åœ°å‘¨æœŸæ•°æ®
      setCycles(prev =>
        prev.map(c =>
          c.id === payload.new.id
            ? { ...c, completion_rate: payload.new.completion_rate }
            : c
        )
      );
    })
    .subscribe();

  return () => {
    supabase.removeChannel(channel);
  };
}, [userId]);
```

---

## å…­ã€APIè°ƒç”¨æµç¨‹

### 6.1 åœºæ™¯: ä¿å­˜è®°å½•

```
ç”¨æˆ·åœ¨ Record.tsx è¾“å…¥å†…å®¹
  â†“
ç‚¹å‡»"Save å·¥ä½œ"æŒ‰é’®
  â†“
handleSaveRecord()
  â”œâ”€ éªŒè¯: note ä¸ä¸ºç©º
  â”œâ”€ è°ƒç”¨: saveRecord(note, 'published')
  â”‚    â†“
  â”‚   useRecords.saveRecord()
  â”‚    â”œâ”€ localRecords.save({ userId, cycleId, dimensionId, date, content })
  â”‚    â”œâ”€ å†™å…¥ localStorage
  â”‚    â””â”€ è§¦å‘ localCycles.updateCompletionRate(cycleId)
  â”‚         â”œâ”€ è®¡ç®—å®Œæˆåº¦ç™¾åˆ†æ¯”
  â”‚         â””â”€ æ›´æ–° cycles æ•°æ®
  â”‚
  â”œâ”€ è¿”å›æˆåŠŸ/å¤±è´¥
  â””â”€ æ˜¾ç¤º Toast æç¤º
```

---

## ä¸ƒã€é”™è¯¯å¤„ç†ä¸éªŒè¯

### 7.1 æ•°æ®éªŒè¯è§„åˆ™

| å­—æ®µ | éªŒè¯è§„åˆ™ | é”™è¯¯æç¤º |
|------|--------|---------|
| **è®°å½•å†…å®¹** | ä¸èƒ½ä¸ºç©º | "è¯·è¾“å…¥è®°å½•å†…å®¹" |
| **é€‰ä¸­æ—¥æœŸ** | å¿…é¡»åœ¨å‘¨æœŸèŒƒå›´å†… | "åªèƒ½ç¼–è¾‘å½“å‰å‘¨æœŸçš„è®°å½•" |
| **å¼€é”€é‡‘é¢** | å¿…é¡»å¤§äº0 | "é‡‘é¢å¿…é¡»å¤§äº0" |
| **ç”¨æˆ·æ˜µç§°** | 1-50å­—ç¬¦ | "æ˜µç§°é•¿åº¦ä¸ç¬¦" |

### 7.2 é”™è¯¯å¤„ç†ç¤ºä¾‹

```typescript
const handleSaveRecord = async () => {
  try {
    if (!note.trim()) {
      alert('è¯·è¾“å…¥è®°å½•å†…å®¹');
      return;
    }

    if (!user || !currentCycle) {
      alert('ç”¨æˆ·ä¿¡æ¯åŠ è½½å¤±è´¥');
      return;
    }

    const success = await saveRecord(note, 'published');
    if (success) {
      alert('è®°å½•å·²ä¿å­˜');
      setNote('');
    } else {
      alert('ä¿å­˜å¤±è´¥ï¼Œè¯·é‡è¯•');
    }
  } catch (error) {
    console.error('Error:', error);
    alert('å‘ç”ŸæœªçŸ¥é”™è¯¯');
  }
};
```

---

## å…«ã€æ€§èƒ½ä¼˜åŒ–å»ºè®®

### 8.1 æ•°æ®åŠ è½½ä¼˜åŒ–

1. **ç¼“å­˜æœºåˆ¶**: localStorage æœ¬èº«å°±æ˜¯ç¼“å­˜
2. **æŒ‰éœ€åŠ è½½**: åªåŠ è½½å½“å‰å‘¨æœŸçš„æ•°æ®
3. **åˆ†é¡µåŠ è½½**: History é¡µé¢é™åˆ¶å•æ¬¡æ˜¾ç¤º 50 æ¡

### 8.2 æ¸²æŸ“ä¼˜åŒ–

1. **ä½¿ç”¨ React.memo**: å¯¹ä¸å¸¸æ›´æ–°çš„ç»„ä»¶ä½¿ç”¨ memo
2. **é˜²æŠ–/èŠ‚æµ**: æœç´¢ã€æ—¥æœŸé€‰æ‹©ç­‰è¾“å…¥åŠ é˜²æŠ–
3. **è™šæ‹Ÿåˆ—è¡¨**: History é¡µé¢é•¿åˆ—è¡¨ä½¿ç”¨è™šæ‹Ÿæ»šåŠ¨

---

## ä¹ã€è¿ç§»è®¡åˆ’ (localStorage â†’ Supabase)

### 9.1 è¿ç§»æ­¥éª¤

1. **ç¬¬ä¸€é˜¶æ®µ** âœ…: ä½¿ç”¨ localStorage å®ç°æ ¸å¿ƒåŠŸèƒ½
2. **ç¬¬äºŒé˜¶æ®µ**: é…ç½® Supabase é¡¹ç›®å’Œæ•°æ®åº“
3. **ç¬¬ä¸‰é˜¶æ®µ**: åˆ›å»º Supabase ç‰ˆæœ¬çš„ Hooks
4. **ç¬¬å››é˜¶æ®µ**: ä¿®æ”¹å¯¼å…¥è·¯å¾„å®Œæˆåˆ‡æ¢
5. **ç¬¬äº”é˜¶æ®µ**: æ•°æ®è¿ç§»è„šæœ¬

### 9.2 Hook å‘½åçº¦å®š

```
å½“å‰:   useRecords.local.ts  (localStorage)
è¿ç§»å: useRecords.ts        (Supabase)
```

---

## åã€æµ‹è¯•æ¸…å•

### 10.1 åŠŸèƒ½æµ‹è¯•

#### Homeé¡µ âœ…
- [x] æ˜¾ç¤ºç”¨æˆ·ä¿¡æ¯
- [x] æ˜¾ç¤ºå½“å‰å‘¨æœŸè¿›åº¦
- [x] æ˜¾ç¤ºä»Šæ—¥å„ç»´åº¦å®ŒæˆçŠ¶æ€
- [ ] å‘¨æœŸçŸ©é˜µç‚¹å‡»äº¤äº’

#### Recordé¡µ âœ…
- [x] ç»´åº¦åˆ‡æ¢
- [x] æ—¥æœŸé€‰æ‹©
- [x] ä¿å­˜è®°å½•
- [x] ä»Šæ—¥æ¦‚è§ˆæ›´æ–°
- [ ] æ–‡ä»¶ä¸Šä¼ 
- [ ] AIè§£æè´¹ç”¨

#### Historyé¡µ âŒ
- [ ] æ˜¾ç¤ºè®°å½•åˆ—è¡¨
- [ ] æ—¥æœŸèŒƒå›´ç­›é€‰
- [ ] ç»´åº¦ç­›é€‰
- [ ] å…¨æ–‡æœç´¢

#### Reporté¡µ âŒ
- [ ] å‘¨æœŸæŠ¥å‘Šç”Ÿæˆ
- [ ] æ—¶é—´è½´æ˜¾ç¤º
- [ ] æ•°æ®æ´å¯Ÿå›¾è¡¨

#### Profileé¡µ âŒ
- [ ] ä¿®æ”¹æ˜µç§°
- [ ] ä¸Šä¼ å¤´åƒ
- [ ] é€€å‡ºç™»å½•

---

## åä¸€ã€å¼€å‘ä¼˜å…ˆçº§

### P0 - æ ¸å¿ƒåŠŸèƒ½ âœ… å·²å®Œæˆ

- [x] Home é¡µæ˜¾ç¤ºå‘¨æœŸå’Œä»Šæ—¥çŠ¶æ€
- [x] Record é¡µè®°å½•ä¿å­˜
- [x] å‘¨æœŸå®Œæˆåº¦è‡ªåŠ¨è®¡ç®—

### P1 - é‡è¦åŠŸèƒ½ âŒ å¾…å¼€å‘

- [ ] History é¡µæŸ¥çœ‹å†å²è®°å½•
- [ ] Expense é¡µå¼€é”€ç®¡ç†
- [ ] Profile é¡µç”¨æˆ·ä¿¡æ¯ç¼–è¾‘

### P2 - å¢å¼ºåŠŸèƒ½ âŒ æœªæ¥å¼€å‘

- [ ] Report é¡µæ•°æ®å¯è§†åŒ–
- [ ] é™„ä»¶ä¸Šä¼ å’ŒOCR
- [ ] AIæ™ºèƒ½åˆ†æ

---

## åäºŒã€æ€»ç»“

### å½“å‰çŠ¶æ€

âœ… **å·²å®Œæˆ:**
- Home é¡µå’Œ Record é¡µæ ¸å¿ƒåŠŸèƒ½
- æœ¬åœ°å­˜å‚¨æ•°æ®å±‚
- 5ä¸ªåŸºç¡€ Hooks

âŒ **å¾…å¼€å‘:**
- History / Expense / Report / Profile é¡µé¢åŠŸèƒ½
- 5ä¸ªæ–°çš„ Hooks
- AI åŠŸèƒ½é›†æˆ
- è¿ç§»åˆ° Supabase

### ä¸‹ä¸€æ­¥å·¥ä½œ

**ç«‹å³å¯åšçš„æ”¹è¿›:**
1. å®Œå–„ History é¡µé¢ï¼Œè¿æ¥çœŸå®æ•°æ®
2. å®Œå–„ Profile é¡µé¢ï¼Œæ”¯æŒç¼–è¾‘ç”¨æˆ·ä¿¡æ¯
3. å®ç° Expense é¡µé¢åŸºç¡€åŠŸèƒ½ï¼ˆæ— AIå…ˆæ‰‹åŠ¨è¾“å…¥ï¼‰

**éœ€è¦å¤–éƒ¨æœåŠ¡çš„åŠŸèƒ½ï¼ˆåç»­ï¼‰:**
- Supabase æ•°æ®åº“å’Œå­˜å‚¨
- Gemini AI API
- æ–‡ä»¶ä¸Šä¼ åŠŸèƒ½

---

**æ–‡æ¡£ç‰ˆæœ¬**: v1.0
**æœ€åæ›´æ–°**: 2026-02-25
**ç»´æŠ¤è€…**: Claude AI Assistant
